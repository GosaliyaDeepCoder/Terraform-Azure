Terraform with Azure by Building a Dev Environment
Step 1: Install Azure CLI and Terraform and Terraform extensions for Vs Code
Install Azure CLI


 
Login to azure via Vs Code:
 
Step 2: How to use Azure Provider
Create main.tf file for Terraform Configuration:
 

Run terraform fmt command: terraform fmt is a command in Terraform, a popular infrastructure as code tool, used to automatically format Terraform configuration files according to a defined style. This command ensures consistent formatting across your Terraform codebase, making it easier to read and maintain.
 
Run terraform Init command:  terraform init is a command used to initialize a Terraform configuration directory. When you're working with Terraform for the first time in a new project or when you've made changes to the configuration that requires new plugins or modules, you need to run terraform init to set up the necessary components.
 
Creating a resource group az-tf-rg in Azure:
 
Run terraform plan command: terraform plan is a command used in Terraform to generate an execution plan. This plan outlines what Terraform will do when you apply your configuration to the infrastructure. It provides a detailed preview of the changes that will be made to your infrastructure based on the current state and the configuration in your Terraform files.
 
Run terraform apply command: terraform apply is a command used in Terraform to apply the changes described in your Terraform configuration files to your infrastructure. It executes the execution plan generated by terraform plan and makes the necessary changes to your infrastructure to bring it to the desired state defined in your configuration.
 



Step 3: Deploying the Virtual Networks (The groundwork)
 
 
Run terraform apply -auto-approve: Skip interactive approval of plan before applying.
 
So, we successfully created our vnet via terraform HCL file:
 

Let learn about terraform state commands:
•	Terraform state list: is a Terraform command used to list all resources managed by Terraform in the state file. The state file is a JSON file that Terraform uses to keep track of the state of your infrastructure. It contains information about the resources Terraform manages, such as their current configuration and metadata.
When you run terraform state list, terraform reads the state file and outputs a list of all resources it is currently managing.
•	terraform state show azurerm_resource_group.Deep-rg:  would display detailed information about the resource group named "Deep-rg" managed by Terraform. This command retrieves and outputs the current state of the specified resource group from the Terraform state file.
The output typically includes various attributes and properties of the resource group, such as its ID, name, location, tags, and any other relevant configuration details specified in your Terraform configuration.
 
Terraform show  is a command used to display the current state of your infrastructure as managed by Terraform. When you run terraform show, terraform reads the state file and generates a human-readable representation of your infrastructure's current state, including all resources managed by Terraform and their attributes.
 














Terraform destroy: 
The command terraform apply -destroy -auto-approve instructs Terraform to apply a destruction plan to your infrastructure and automatically approve it without asking for confirmation.
 
You can see the current state shows we don’t have any resources:
 
Now after running terraform apply again, it will create the infrastructure back as it was:
 

Step 4: Deploying Azure Subnet:
 
 

Step 5: Creating NSG and Rules:
 
 
Step 6: Associate Security group to our Subnet
 
 
Step 7: Creating a Public IP(Dynamic) for our Future VMs
 
 
The IP address is null as it has not been associated to any resources like Vm 
 
Step 8: Creating NIC for Network connectivity for VMs.
This NIC will receive its public IP address from IP address we just created.
 


















Step 9: Generate SSH key pair and create a VM.
 
 
 
As you can see, we have used file function of terraform to extract the value that is key pair form the mentioned file path under (“----”)

 
Step 10: SSH to the Linux VM
 
 
Step 11: Now let’s Install Docker on our VM but using Custom data.
First create new file name customdata.tpl tpl stands for template file:  



Add the file to our terraform configuration file  
So, in this case the custom data will forced to destroy the VM that got created earlier and will replace it with new VM that has Docker installed. All these will happen while the creation of VM that’s the magic of Custom data.
 
Ssh to the vm as mentioned above and check whether docker got installed:
 
Step 12: Create and add SSH Config Scripts:
First Install Remote SSH extension in VS code. Then Goto ViewCommand PaletteRemote SSH: Add New Host click on thatadd <ssh admin@admin.com> and click you will see a config file so we just want to add new configuration for our azure vm instance in these file
 
Step 13: In this step, we're going to utilize a provisioner to configure the VScode on our local terminal to be able to SSH into our VM.
 
Note: Terraform cannot model the actions of provisioners as part of a plan as it does not get picked up by the state.
Now to Check the connection goto ViewCommand PaletteRemote-SSH: Connect to Host  select the IP of our VM.
 
Select VM Operating system in our case its Linux
 

 
So now we have a remote terminal directly to our instance so now developers can start developing
echo "# Terraform-Azure" >> README.md
git init
git add README.md
git commit -m "first commit"
git branch -M master
git remote add origin https://github.com/GosaliyaDeepCoder/Terraform-Azure.git
git push -u origin master
